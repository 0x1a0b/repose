<?xml version="1.0" encoding="UTF-8"?>

<power-proxy xmlns="http://docs.rackspacecloud.com/power-api/system-model/v2.0">
   
   <!-- REPOSE auth and versioning domain.  This will auth and determine which version of the request we are servicing -->
   <service-domain id="nova-auth">
      <service-domain-nodes>
         <node id="repose-nova-av-n01" hostname="repose-nova-av-n01.ord.internal.rackspace.corp" http-port="8080" />
         <node id="repose-nova-av-n02" hostname="repose-nova-av-n02.ord.internal.rackspace.corp" http-port="8080" />
      </service-domain-nodes>      
      
      <filters>
         <filter name="client-authentication" />
         <filter name="client-authorization" />
         <filter name="service-versioning" />
      </filters>
      
      <!-- versioning will choose a destination based on uri rules.  Must be one of these two -->
      <destinations>
         <target-domain id="trans" target-domain="nova-cs-legacy-translation" protocol="http"/>
         <target-domain id="limiting" target-domain="nova-rate-limiting" protocol="http"/>
      </destinations>
   </service-domain>
   
   <!-- REPOSE translation domain will translante 1.0 requests/responses to/from 2.0 -->
   <service-domain id="nova-cs-legacy-translation">
      <service-domain-nodes>
         <node id="repose-csl-trans-n01" hostname="repose-csl-trans-n01.ord.internal.rackspace.corp" http-port="8080" />
         <node id="repose-csl-trans-n02" hostname="repose-csl-trans-n02.ord.internal.rackspace.corp" http-port="8080" />
      </service-domain-nodes>      

      <filters>
         <filter name="http-Logging" />
         <filter name="translation" />
         <filter name="default-router" />
      </filters>
   
      <!-- only destination available is rate limiting -->
      <destinations>
         <target-domain id="limiting" target-domain="nova-rate-limiting" protocol="http" default="true" />
      </destinations>
   </service-domain>
   
   <!-- REPOSE rate limiting domain -->
   <service-domain name="nova-rate-limiting">
      <service-domain-nodes>
         <node id="repose-nova-rl-n01" hostname="repose-nova-rl-n01.ord.internal.rackspace.corp" http-port="8080" />
         <node id="repose-nova-rl-n02" hostname="repose-nova-rl-n02.ord.internal.rackspace.corp" http-port="8080" />
      </service-domain-nodes>      
      
      <filter-chain name="nova-rate-limiting">
         <filter name="dist-datastore" />
         <filter name="rate-limiting" />
         <filter name="default-router" />
      </filter-chain>
   
      <!-- only destination available is NOVA API -->
      <destinations>
         <target-domain id="nova" target-domain="nova-api" protocol="http" default="true"/>
      </destinations>
   </service-domain>

   <!-- NOVA service api domain -->
   <service-domain id="nova-api">
      <service-domain-nodes>
         <node id="nova-n01" hostname="nova-n01.ord.internal.rackspace.corp" http-port="8080" />
         <node id="nova-n02" hostname="nova-n02.ord.internal.rackspace.corp" http-port="8080" />
      </service-domain-nodes>
   </service-domain>
  
</power-proxy>
