<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book [
<!-- product name is likely to change; parameterize full name, abbreviated name, expanded name -->
<!ENTITY PRODNAME "Repose">
<!ENTITY PRODABBREV "Repose">
<!ENTITY PRODEXPAND "REstful PrOxy Service Engine">
    <!-- Some useful entities borrowed from HTML -->
    <!ENTITY ndash  "&#x2013;">
    <!ENTITY mdash  "&#x2014;">
    <!ENTITY hellip "&#x2026;">

    <!-- Useful for describing APIs -->
    <!ENTITY GET    '<command xmlns="http://docbook.org/ns/docbook">GET</command>'>
    <!ENTITY PUT    '<command xmlns="http://docbook.org/ns/docbook">PUT</command>'>
    <!ENTITY POST   '<command xmlns="http://docbook.org/ns/docbook">POST</command>'>
    <!ENTITY DELETE '<command xmlns="http://docbook.org/ns/docbook">DELETE</command>'>

    <!ENTITY CHECK  '<inlinemediaobject xmlns="http://docbook.org/ns/docbook">
        <imageobject>
        <imagedata fileref="img/Check_mark_23x20_02.svg"
        format="SVG" scale="60"/>
        </imageobject>
        </inlinemediaobject>'>

    <!ENTITY ARROW  '<inlinemediaobject xmlns="http://docbook.org/ns/docbook">
        <imageobject>
        <imagedata fileref="img/Arrow_east.svg"
        format="SVG" scale="60"/>
        </imageobject>
        </inlinemediaobject>'>
]>
<!-- in BOOK below, add status="draft" to set watermark on cover and left margin -->
<book version="5.0" xmlns="http://docbook.org/ns/docbook"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:svg="http://www.w3.org/2000/svg"
      xmlns:m="http://www.w3.org/1998/Math/MathML"
      xmlns:html="http://www.w3.org/1999/xhtml"
      xmlns:db="http://docbook.org/ns/docbook" 
      xml:id="Repose-Ratelimiting-Deployment-Guide">
    <?rax pdf.url="../../repose-ratelimiting-deploy.pdf"?>
    <title>&PRODNAME; Translation Component Deployment
        Handbook</title>
    <!-- set watermark on cover and left margin 
        <?rax status.bar.text="CONFIDENTIAL"?>
    -->
    <?rax title.font.size="35px" subtitle.font.size="16px"?>
    <titleabbrev>&PRODABBREV; Translation Deployment</titleabbrev>
    <info>
        <author>
            <personname>
                <firstname/>
                <surname/>
            </personname>
            <affiliation>
                <orgname>Rackspace Cloud</orgname>
            </affiliation>
        </author>
        <copyright>
            <year>2010</year>
            <year>2011</year>
            <year>2012</year>
            <holder>Rackspace US, Inc.</holder>
        </copyright>
        <releaseinfo>v2.3.4</releaseinfo>
        <productname>&PRODNAME;</productname>
        <pubdate>2012-11-26</pubdate>
        <legalnotice role="apache2">
            <annotation>
                <remark>Copyright details are filled in by the template.</remark>
            </annotation>
        </legalnotice>
        <abstract>
            <para>This document is intended for systems administrators
                interested in configuring their service to use the
                Translation component of the &PRODEXPAND;. </para>
        </abstract>
        <revhistory>
            <revision>
                <date>2012-11-23</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem><para>Initial release as internal draft.</para></listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
        </revhistory>
    </info>
    <chapter xml:id="Overview-d1e85">
        <title>About This Document</title>
            <para> 
                The purpose of this handbook is to facilitate deployment of &PRODNAME;'s translation component. This handbook is not a tutorial. It provides basic information
                that will help you understand and deploy this &PRODNAME; component, but you must
                adapt this information to suit your own configuration. 
            </para>  
            <para>
                This handbook is focused on one &PRODNAME; component.
                Other &PRODNAME; components are documented in companion handbooks.
            </para>
        <section xml:id="Document_Change_History-d1e102">
            <title>Document Change History</title>
            <para>This version of the handbook replaces and obsoletes all previous versions.
            The most recent changes are described in the table below: </para>
            <?rax revhistory?>
        </section>
        <xi:include href="chapters/available-doc.xml"/>
    </chapter>
    <!-- naming this section xml:id="Introduction-000" to make it the first page opened in HTML, matching <webhelpDefaultTopic>Introduction-000.html</webhelpDefaultTopic> in pom.xml -->
    <chapter xml:id="Introduction-000">
        <title>Introduction to the Translation Component of &PRODNAME;</title>
        <para> Translation changes the format of a request or response so that it meets the expectations of the service or client that receives it.
            You can use
            &PRODNAME;'s translation filter to transform XML into JSON. 
            You can also use
            &PRODNAME;'s translation filter to transform JSON into JSONx, which is formatted like XML.
            Whether or not you transform the body of the message into another format, you can use the translation filter to remove elements that are invalid for the receiver
            or to add elements that are required by the receiver. 
            This means you can choose components to combine in a stack based on their core features; 
            without the &PRODNAME; translation filter, incompatible standards for output and input might make some otherwise-beneficial combinations impractical. 
        </para>
        <para>
            To use &PRODNAME; for translation, you must add the translation component as a filter in your &PRODNAME; configuration. 
            You can learn more about customizing your &PRODNAME; configuration 
            by reading the 
            <link xlink:href="http://openrepose.org/documentation/repose-deploy/content/Introduction-000.html">Repose Deployment Handbook</link>
            and by examining a  
            <link xlink:href="https://github.com/rackspace/repose/blob/master/project-set/core/core-lib/src/main/resources/META-INF/schema/examples/system-model.cfg.xml">basic system model configuration</link>
            in GitHub.
        </para>
        <para> &PRODNAME; uses 
            <link xlink:href="http://saxon.sourceforge.net/">Saxon 9.3</link>
            to perform translation by
            applying <link xlink:href="http://www.w3.org/TR/xslt20/"
                >XSLT 2.0 stylesheets</link> to requests and
            responses. In addition to adding the translation filter to
            your configuration, you must create and customize your
            stylesheets to define the changes you wish the translation
            filter to perform. </para>
         <para> The &PRODNAME; translation component performs two
            categories of behavior: <itemizedlist>
                <listitem>
                    <para>
                        <link linkend="Change_Format-d1e105"
                            >changing the format of a message</link>
                        (translating between JSON and XML)</para>
                </listitem>
                <listitem>
                    <para>
                        <link linkend="Change_Content-d1e125"
                            >changing the content of a message</link>
                        (adding or deleting elements)</para>
                </listitem>
            </itemizedlist>
        </para>
        <tip>
            <para> Rate limits are controlled by
                    <code>translation.cfg.xml</code>; to change your
                rate limiting configuration, edit
                    <code>translation.cfg.xml</code>. You can see an
                annotated example of <code>translation.cfg.xml</code>
                in <xref linkend="Configuration-d1e365"/>. </para>
        </tip>
    </chapter>
    <chapter xml:id="Configuration-d1e365">
        <title>Configuration</title>
        <tip>
            <para> Before attempting to customize your translation
                configuration and its stylesheets, familiarize
                yourself with the basic &PRODNAME; concepts and
                deployment methods in our <link
                    xlink:href="hhttp://openrepose.org/documentation/repose-intro/content/Introduction-000.html"
                    >Getting Started</link> document. </para>
        </tip>
        <para> The rate limiting component obtains its configuration,
            including its API endpoint, from a file named
                <code>translation.cfg.xml</code>. We have included an
            annotated example of a valid
                <code>translation.cfg.xml</code> in this
            chapter.</para>
        <para> To change your translation configuration, edit
                <code>translation.cfg.xml</code> at any time. Within
                <code>translation.cfg.xml</code>, you can specify
            which stylesheets are to be applied under what
            circumstances; as with the translation configuration, you can edit your stylesheets to make changes at runtime. </para> 
        <section xml:id="Customizing_Translation_Configuration-d1e375">
        <title>Customizing a Translation Configuration</title>
        <para>
            Your translation configuration in <code>translation.cfg.xml</code> will resemble the following example:
        </para>
        <example>
            <title>Translation Configuration</title>
            <programlistingco>
                <areaspec>
                    <area xml:id="cfg.xml.request-endpoint"
                        units="linecolumn" coords="5 22"/>
                    <area xml:id="cfg.xml.uri-regex"
                        units="linecolumn" coords="5 32"/>
                    <area xml:id="cfg.xml.include-absolute-limits"
                        units="linecolumn" coords="6 32"/>
                    <area xml:id="cfg.xml.limit-group"
                        units="linecolumn" coords="8 17"/>
                    <area xml:id="cfg.xml.id" units="linecolumn"
                        coords="8 21"/>
                    <area xml:id="cfg.xml.groups" units="linecolumn"
                        coords="9 15"/>
                    <area xml:id="cfg.xml.default" units="linecolumn"
                        coords="9 35"/>
                    <area xml:id="cfg.xml.limit" units="linecolumn"
                        coords="10 15"/>
                </areaspec>
                <programlisting language="xml">
<xi:include href="samples/repose-translation.cfg.xml" parse="text"/>
            </programlisting>
            </programlistingco>
        </example>
        <para> Key elements of the preceding example are labeled with
            callouts and explained below: </para>
        <calloutlist>
            <callout arearefs="cfg.xml.request-endpoint">
                <para> The <code>request-endpoint</code> configuration
                    element must specify a regular expression that
                    identifies client requests for the client's
                    current limits. </para>
                <para>This element is
                    <emphasis>required</emphasis>.</para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.uri-regex">
                <para> The <code>uri-regex</code> attribute of the
                        <code>request-endpoint</code> configuration
                    element must be a regular expression. It should
                    match all representations of the request resource
                    that the rate limiting component should answer. </para>
                <para>This attribute is
                    <emphasis>required</emphasis>.</para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.include-absolute-limits">
                <para> The <code>include-absolute-limits</code>
                    attribute of the <code>request-endpoint</code>
                    configuration element is a Boolean attribute that
                    can be used to switch on or off integration with
                    the origin service's absolute limits. </para>
                <para>This attribute is
                    <emphasis>optional</emphasis>.</para>
                <para>Acceptable values are <code>TRUE</code>,
                        <code>FALSE</code>.</para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.limit-group">
                <para> One or more specifications of
                        <code>limit-group</code> may be associated
                    with a single specification of
                        <code>request-endpoint</code>. </para>
                <para> Limit groups identify a group of related rate
                    limits and bind them to a series of names. The
                    names can be used to limit incoming requests using
                    the <code>X-PP-Groups</code> header. </para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.id">
                <para> An <code>id</code> uniquely identifies each
                        <code>limit-group</code>.</para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.groups">
                <para> Specifying <code>groups</code> for a
                        <code>limit-group</code> associates it with
                    recognizable workloads. In this example, one
                        <code>limit-group</code> relates to customers
                    and another relates to administrators. </para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.default">
                <para> A single <code>limit-group</code> may be
                    identified as the <code>default</code> group. The
                        <code>default</code> group will handle any
                    requests that cannot be matched on the basis of a
                    group name to any of the groups identified in the
                        <code>X-PP-Groups</code> header. In this
                    example, the limits defined for
                        <code>groups="customer"</code> will be applied
                    to requests that cannot be explicitly matched to a
                    group. </para>
                <para> </para>
            </callout>
            <callout arearefs="cfg.xml.limit">
                <para>
                    <code>limit</code> and its attributes are
                    discussed in somewhere. </para>
                <para> </para>
            </callout>
        </calloutlist>
        </section>
            <section xml:id="Customizing_Translation_Stylesheet-d1e385">
                <title>Customizing a Translation Stylesheet</title>
                <para> 
                    The &PRODNAME; translation component uses 
                    <link xlink:href="http://www.w3.org/TR/xslt20/">XSLT 2.0 stylesheets</link> to process messages. 
                    One place to learn the basics of XLST is the 
                    <link xlink:href="http://www.w3schools.com/xsl/xsl_w3celementref.asp">XSLT Elements Reference</link>.
                </para>
                <para>
                    You can create and combine multiple stylesheets to accomplish the translation you require.
                    To make stylesheets active within your &PRODNAME; 
                    configuration, specify them in <code>translation.cfg.xml</code> as shown at 
                    <xref linkend="Customizing_Translation_Configuration-d1e375"></xref>
                </para>
                <para>
                    A valid stylesheet resembles the following example:
                </para>
                <example>
                    <title>Translation Configuration</title>
                    <programlistingco>
                        <areaspec>
                            <area xml:id="cfg.xml.request-endpoint"
                                units="linecolumn" coords="5 22"/>
                            <area xml:id="cfg.xml.uri-regex"
                                units="linecolumn" coords="5 32"/>
                            <area xml:id="cfg.xml.include-absolute-limits"
                                units="linecolumn" coords="6 32"/>
                            <area xml:id="cfg.xml.limit-group"
                                units="linecolumn" coords="8 17"/>
                            <area xml:id="cfg.xml.id" units="linecolumn"
                                coords="8 21"/>
                            <area xml:id="cfg.xml.groups" units="linecolumn"
                                coords="9 15"/>
                            <area xml:id="cfg.xml.default" units="linecolumn"
                                coords="9 35"/>
                            <area xml:id="cfg.xml.limit" units="linecolumn"
                                coords="10 15"/>
                        </areaspec>
                        <programlisting language="xml">
<xi:include href="samples/repose-translation-identity.xsl" parse="text"/>
            </programlisting>
                    </programlistingco>
                </example>
                <para> Key elements of the preceding example are labeled with
                    callouts and explained below: </para>
                <calloutlist>
                    <callout arearefs="cfg.xml.request-endpoint">
                        <para> The <code>request-endpoint</code> configuration
                            element must specify a regular expression that
                            identifies client requests for the client's
                            current limits. </para>
                        <para>This element is
                            <emphasis>required</emphasis>.</para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.uri-regex">
                        <para> The <code>uri-regex</code> attribute of the
                            <code>request-endpoint</code> configuration
                            element must be a regular expression. It should
                            match all representations of the request resource
                            that the rate limiting component should answer. </para>
                        <para>This attribute is
                            <emphasis>required</emphasis>.</para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.include-absolute-limits">
                        <para> The <code>include-absolute-limits</code>
                            attribute of the <code>request-endpoint</code>
                            configuration element is a Boolean attribute that
                            can be used to switch on or off integration with
                            the origin service's absolute limits. </para>
                        <para>This attribute is
                            <emphasis>optional</emphasis>.</para>
                        <para>Acceptable values are <code>TRUE</code>,
                            <code>FALSE</code>.</para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.limit-group">
                        <para> One or more specifications of
                            <code>limit-group</code> may be associated
                            with a single specification of
                            <code>request-endpoint</code>. </para>
                        <para> Limit groups identify a group of related rate
                            limits and bind them to a series of names. The
                            names can be used to limit incoming requests using
                            the <code>X-PP-Groups</code> header. </para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.id">
                        <para> An <code>id</code> uniquely identifies each
                            <code>limit-group</code>.</para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.groups">
                        <para> Specifying <code>groups</code> for a
                            <code>limit-group</code> associates it with
                            recognizable workloads. In this example, one
                            <code>limit-group</code> relates to customers
                            and another relates to administrators. </para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.default">
                        <para> A single <code>limit-group</code> may be
                            identified as the <code>default</code> group. The
                            <code>default</code> group will handle any
                            requests that cannot be matched on the basis of a
                            group name to any of the groups identified in the
                            <code>X-PP-Groups</code> header. In this
                            example, the limits defined for
                            <code>groups="customer"</code> will be applied
                            to requests that cannot be explicitly matched to a
                            group. </para>
                        <para> </para>
                    </callout>
                    <callout arearefs="cfg.xml.limit">
                        <para>
                            <code>limit</code> and its attributes are
                            discussed in somewhere. </para>
                        <para> </para>
                    </callout>
                </calloutlist>
        </section>
    </chapter>
    <chapter xml:id="Change_Format-d1e105">
        <title>Changing a Message's Format</title>
        <para> 
            Explain it all here. 
        </para>
    </chapter>
    <chapter xml:id="Change_Content-d1e125">
        <title>Changing a Message's Content</title>
        <para> 
            Explain it all here. 
        </para>
    </chapter>
    <xi:include href="chapters/afterword.xml"/>
</book>